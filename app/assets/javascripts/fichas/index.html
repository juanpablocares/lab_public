<div ng-if="loading" class="row text-center">
	<i class="fa fa-spinner fa-pulse fa-2x"></i>	
</div>

<div class="widget-container fluid-height" ng-if="!loading">
	<div class="widget-content padded">
		<form>
			<div>
				<table class="table table-bordered" ng-if="examenesSeleccionados.length != 0">
					<thead>
						<th>CÃ³digo</th>
						<th>Examen</th>
						<th>Tipo muestra</th>
						<th>Indicaciones</th>
						<th>Proceso</th>
						<th>Dia proceso</th>
						<th>Demora</th>
						<th>Estado</th>
						<th>Precio</th>
					</thead>
					<tbody>
						<tr ng-repeat="item in examenesSeleccionados track by $index" ng-if="!item.perfil">
							<td>{{item.examen.codigo_fonasa?item.examen.codigo_fonasa:'---'}}</td>
							<td>{{item.examen.nombre?item.examen.nombre:'---'}}</td>
							<td>{{item.examen.tipo_muestra.muestra?item.examen.tipo_muestra.muestra:'---'}}</td>
							<td>{{item.examen.indicacion.descripcion?item.examen.indicacion.descripcion:'---'}}</td>
							<td>{{item.examen.externo!=0?'Interno':'Externo'}}</td>
							<td>{{item.examen.dia_proceso?item.examen.dia_proceso:'---'}}</td>
							<td>{{item.examen.demora_proceso?item.examen.demora_proceso:'---'}}</td>
							<td><label class="label label-{{item.estado.class}}">{{item.estado.texto}}</label></td>
							<td>{{item.precio?item.precio:0}}</td>
						</tr>
					</tbody>
					<tbody ng-repeat="item in examenesSeleccionados track by $index" ng-if="item.perfil">
						<tr>
							<td colspan="9"><strong>{{item.nombre}}</strong></td>
						</tr>
						<tr ng-repeat="detalle in item.detalles_ficha">
							<td>{{detalle.examen.codigo_fonasa?detalle.examen.codigo_fonasa:'---'}}</td>
							<td>{{detalle.examen.nombre?detalle.examen.nombre:'---'}}</td>
							<td>{{detalle.examen.tipo_muestra.muestra?detalle.examen.tipo_muestra.muestra:'---'}}</td>
							<td>{{detalle.examen.indicacion.descripcion?detalle.examen.indicacion.descripcion:'---'}}</td>
							<td>{{detalle.examen.externo!=0?'Interno':'Externo'}}</td>
							<td>{{detalle.examen.dia_proceso?detalle.examen.dia_proceso:'---'}}</td>
							<td>{{detalle.examen.demora_proceso?detalle.examen.demora_proceso:'---'}}</td>
							<td><label class="label label-{{detalle.estado.class}}">{{detalle.estado.texto}}</label></td>
							<td>{{detalle.precio?detalle.precio:0}}</td>
						</tr>
					</tbody>
					<tbody>
						<tr>
							<td colspan="8"><strong>Precio total</strong></td>
							<td class="text-danger">{{ficha.precio_total}}</td>
						</tr>
						<tr>
							<td colspan="8"><strong>Pagado</strong></td>
							<td class="text-success">{{getTotalPagos()}}</td>
						</tr>
						<tr>
							<td colspan="8"><strong>Total</strong></td>
							<td ng-class="{'text-success': ficha.precio_total < getTotalPagos(), 'text-danger': ficha.precio_total > getTotalPagos()}">{{ficha.precio_total - getTotalPagos()}}</td>
						</tr>
					</tbody>
				</table>
			</div>
		</form>
	</div>
</div>